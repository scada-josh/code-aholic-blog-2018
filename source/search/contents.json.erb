<%
pages = sitemap.resources.find_all { |p| p.source_file.match(/\.markdown/) || p.source_file.match(/\.php/) || p.source_file.match(/\.html/) }
entries = []

pages.each_with_index do |page, index|
  object = {}
  # if page.data.isIndexPage != true
    
    # ... some specifics ommitted
    entry = {
      :id    => index,
      :title => page.data.title,
      :url   => page.url,
      # :content => page.render({:layout => false }).gsub(
      #  %r{</?[^>]+?>}, '' )
    }
    entries << entry
  # end
end
%><%= entries.to_json %>